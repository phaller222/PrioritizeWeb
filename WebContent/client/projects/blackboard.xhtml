<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:pe="http://primefaces.org/ui/extensions">

<h:body>
	<ui:composition template="../templates/main.xhtml">
		<ui:define name="content">
			<h:form id="dataform">
				<!-- <f:metadata>
					<f:event type="preRenderView"
						listener="#{basicTimelineController.updateTimeline()}" />
				</f:metadata> -->
				<p:layout>
					<p:layoutUnit position="north" size="80">
						<div
							style="font-size: 18pt; margin-left: 25px; margin-top: 5px; margin-bottom: 5px;"
							align="left">
							<img src="../../images/blackboardbig.png" title="Blackboard" />
							<h:outputText
								value=" #{listProjectsBean.currentProject.name} - Tasks" />
						</div>
					</p:layoutUnit>

					<p:layoutUnit position="center" size="700" maxSize="900"
						resizable="true">
						<div align="center">
							<h:form id="progressform">
								<p:progressBar id="progressProject" widgetVar="progressProject"
									value="#{listProjectsBean.currentProject.progress.progress}"
									labelTemplate="{value}% complete" displayOnly="true"
									style="margin-top:10px;height:20px;width:50%" ajax="false" />
							</h:form>
						</div>
						<h:panelGrid layout="tabular" columns="7"
							styleClass="ui-panelgrid" cellspacing="30" cellpadding="40"
							>

<p:scrollPanel style="width:850px;height:550px">
							<ui:repeat var="task"
								value="#{listProjectsBean.getProjectTasks(listProjectsBean.currentProject).stream().toList()}">


								<p:panel
									rendered="#{task.taskStatus.name().equals('STARTED') || task.taskStatus.name().equals('ASSIGNED')}"
									id="taskpanelAssigned" header="#{task.name}" toggleable="true"
									draggable="true"
									style="margin-left:25px;margin-bottom:10px;height:100%;width:280px;opacity:0.4;"
									styleClass="ui-dashboard-column">
								
											<h:outputText value="#{task.description}"
												disabled="#{task.taskStatus.name().equals('ASSIGNED')}" />
											<p:progressBar id="progressAssigned"
												disabled="#{task.taskStatus.name().equals('ASSIGNED')}"
												value="#{task.projectGoalRecord.percentage}"
												labelTemplate="#{task.taskStatus} {value}%"
												displayOnly="true" style="opacity:1;" />
											<div align="left"
												style="padding-right: 30px; max-width: 100px; text-align: left">
												<!-- <p:outputLabel value="#{task.assignees.iterator().next()}"></p:outputLabel> -->
											</div>
											<div align="right"
												style="background-color: rgb(243, 243, 243);">
												<img src="../../images/task_assigned.png" width="20"
													title="Task already assigned" />
											</div>
											<p:tooltip for="progressAssigned"
												value="#{task.projectGoalRecord.percentage} percent of the task have been completed."
												trackMouse="true"></p:tooltip>
								
									<!-- <f:facet name="footer"> -->

									<!-- </f:facet> -->
								</p:panel>
								<p:draggable for="taskpanelAssigned"/>

								<p:contextMenu for="taskpanelAssigned">
									<p:menuitem value="Take Task" disabled="true"
										action="#{listProjectsBean.assignTaskToUser(task)}"
										update="dataform"></p:menuitem>
									<p:menuitem value="Resolve Task" disabled="true"></p:menuitem>
									<p:menuitem value="Details..."></p:menuitem>
									<p:menuitem></p:menuitem>
								</p:contextMenu>
								





								<p:panel id="taskpanel" header="#{task.name}"
									rendered="#{task.taskStatus.name() == 'OPEN' || task.taskStatus.name() == 'CREATED'}"
									toggleable="true"
									style="margin-left:25px;margin-bottom:10px;height:100%;width:240px;opacity: 1;"
									styleClass="ui-dashboard-column" headerClass="ui-panel">
									
											<h:outputText value="#{task.description}"
												disabled="#{task.taskStatus.name().equals('ASSIGNED')}"
												style="font-size:85%" />
											<p:progressBar id="progress"
												disabled="#{task.taskStatus.name().equals('ASSIGNED')}"
												value="#{task.projectGoalRecord.percentage}"
												labelTemplate="#{task.taskStatus} {value}%"
												displayOnly="true" style="opacity:1;" />
											<div align="left"
												style="padding-right: 30px; max-width: 100px; text-align: left">
												<p:outputLabel value="Task unassigned!"></p:outputLabel>

											</div>
											<div align="right"
												style="background-color: rgb(243, 243, 243);">
												<img src="../../images/task_open.png" width="20"
													title="Task not assigned!" />
											</div>

										
								</p:panel>
								<p:draggable for="taskpanel"/>
								
								<p:contextMenu for="taskpanel">
									<p:menuitem ajax="false" value="Take Task" disabled="false"
										action="#{listProjectsBean.assignTaskToUser(task)}"
										update="dataform"></p:menuitem>
									<p:menuitem value="Resolve Task" disabled="true"></p:menuitem>
									<p:menuitem value="Details..."></p:menuitem>
									<p:menuitem></p:menuitem>
								</p:contextMenu>



								<p:panel id="taskpanelFinished" header="#{task.name}"
									rendered="#{task.taskStatus.name() == 'FINISHED' || task.taskStatus.name() == 'CLOSED'}"
									toggleable="true"
									footer="#{task.taskStatus.toString()} #{task.projectGoalRecord.percentage} %"
									style="margin-left:25px;margin-bottom:10px;height:100%;width:240px;opacity:1.0"
									styleClass="ui-dashboard-column">

									
											<h:outputText value="#{task.description}"
												disabled="#{task.taskStatus.name() == 'ASSIGNED'}" />
										
									<f:facet name="footer">
										<p:progressBar id="progressFinished" style="opacity: 1;"
											disabled="#{task.taskStatus.name() == 'ASSIGNED'}"
											value="#{task.projectGoalRecord.percentage}"
											labelTemplate="#{task.taskStatus} {value}%"
											displayOnly="true" />
										<div align="right"
											style="background-color: rgb(243, 243, 243);">
											<img src="../../images/check_ok.png" width="20" title="Task Finished" />
										</div>

									</f:facet>
								</p:panel>
								<p:draggable for="taskpanelFinished"/>
							
								<p:contextMenu for="taskpanelFinished">
									<p:menuitem ajax="false" value="Take Task" disabled="false"
										action="#{listProjectsBean.assignTaskToUser(task)}"
										update="dataform"></p:menuitem>
									<p:menuitem value="Resolve Task" disabled="true"
										update="dataform" ajax="false"></p:menuitem>
									<p:menuitem value="Details..."></p:menuitem>
									<p:menuitem></p:menuitem>
								</p:contextMenu>

							</ui:repeat>
                            </p:scrollPanel>

						</h:panelGrid>
					</p:layoutUnit>
					<p:layoutUnit position="east" size="600" minSize="500"
						resizable="true">
						<h1>Assigned to me</h1>

						<p:dataTable id="tasktable" var="task" selectionMode="single"
							rowKey="#{task.id}" selection="#{listProjectsBean.selectedTask}"
							value="#{listProjectsBean.myTasksForCurrentProject}" style="width:580px;"
							resizableColumns="true" draggableColumns="true"
							draggableRows="true" liveResize="true" sortOrder="ascending"
							sortBy="#{task.name}"
							emptyMessage="No Tasks assigned to you yet!">


							<p:column id="priority" headerText="Prioritiy"
								styleClass="tablecolumsmall" width="50">
								<h:outputText id="taskpriority" value="#{task.priority}" />
								<p:tooltip for="taskpriority"
									value="Priority of task #{task.name}" trackMouse="true"></p:tooltip>
							</p:column>

							<p:column headerText="Name" id="name"
								styleClass="tablecolumsmall" width="150">
								<h:outputText id="taskname" value="#{task.name}" />

								<p:tooltip for="taskname" value="#{task.description}"
									trackMouse="true"></p:tooltip>
							</p:column>

							<p:column headerText="Progress" styleClass="tablecolumsmall"
								width="100">
								<p:progressBar id="progress"
									value="#{task.projectGoalRecord.percentage}"
									labelTemplate="#{task.taskStatus} {value}%" displayOnly="true" />
								<p:tooltip for="progress"
									value="#{task.projectGoalRecord.percentage} percent of the task have been completed."
									trackMouse="true"></p:tooltip>

							</p:column>


						</p:dataTable>
						<p:contextMenu for="tasktable">
							<p:menuitem ajax="false" value="Drop Task" disabled="false"
								action="#{listProjectsBean.unassignTask(listProjectsBean.selectedTask)}"
								update="dataform"></p:menuitem>
							<p:menuitem value="Resolve Task" ajax="false" disabled="false"
								update="dataform,progressProject"
								action="#{listProjectsBean.resolveTask(listProjectsBean.selectedTask)}"></p:menuitem>
							<p:submenu label="Set progress">
								<p:menuitem value=" 0% " ajax="false" disabled="false"
									update="dataform,progressProject"
									action="#{listProjectsBean.setTaskProgress(listProjectsBean.selectedTask, 0)}"></p:menuitem>
								<p:menuitem value=" 10% " ajax="false" disabled="false"
									update="dataform,progressProject"
									action="#{listProjectsBean.setTaskProgress(listProjectsBean.selectedTask, 10)}"></p:menuitem>
								<p:menuitem value=" 20% " ajax="false" disabled="false"
									update="dataform,progressProject"
									action="#{listProjectsBean.setTaskProgress(listProjectsBean.selectedTask, 20)}"></p:menuitem>
								<p:menuitem value=" 30% " ajax="false" disabled="false"
									update="dataform,progressProject"
									action="#{listProjectsBean.setTaskProgress(listProjectsBean.selectedTask, 30)}"></p:menuitem>
								<p:menuitem value=" 40% " ajax="false" disabled="false"
									update="dataform,progressProject"
									action="#{listProjectsBean.setTaskProgress(listProjectsBean.selectedTask, 40)}"></p:menuitem>
								<p:menuitem value=" 50% " ajax="false" disabled="false"
									update="dataform,progressProject"
									action="#{listProjectsBean.setTaskProgress(listProjectsBean.selectedTask, 50)}"></p:menuitem>
								<p:menuitem value=" 60% " ajax="false" disabled="false"
									update="dataform,progressProject"
									action="#{listProjectsBean.setTaskProgress(listProjectsBean.selectedTask, 60)}"></p:menuitem>
								<p:menuitem value=" 70% " ajax="false" disabled="false"
									update="dataform,progressProject"
									action="#{listProjectsBean.setTaskProgress(listProjectsBean.selectedTask, 70)}"></p:menuitem>
								<p:menuitem value=" 80% " ajax="false" disabled="false"
									update="dataform,progressProject"
									action="#{listProjectsBean.setTaskProgress(listProjectsBean.selectedTask, 80)}"></p:menuitem>
								<p:menuitem value=" 90% " ajax="false" disabled="false"
									update="dataform,progressProject"
									action="#{listProjectsBean.setTaskProgress(listProjectsBean.selectedTask, 90)}"></p:menuitem>
								<p:menuitem value=" 100% " ajax="false" disabled="false"
									update="dataform,progressProject"
									action="#{listProjectsBean.setTaskProgress(listProjectsBean.selectedTask, 100)}"></p:menuitem>

							</p:submenu>
							<p:menuitem value="Details..."></p:menuitem>
							<p:menuitem></p:menuitem>
						</p:contextMenu>



					</p:layoutUnit>
					<p:layoutUnit position="south" size="0" maxsize=""></p:layoutUnit>
				</p:layout>
				<!-- <p:poll interval="60" update="dataform"></p:poll> -->
			</h:form>

		</ui:define>
	</ui:composition>
</h:body>

</html>
